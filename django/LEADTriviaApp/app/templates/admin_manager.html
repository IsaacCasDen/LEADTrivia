{% extends 'base.html'%}
{% load static %}

{% block content%}

<style>
    form {
        padding:0.25em;
    }
</style>

<script>
    var games = {{Games|safe}}

    document.onreadystatechange = function() {
        if (document.readyState=="complete") {
            init();
        }
    }

    function init() {
        addGames();
    }
    function addGames() {
        var divParent = document.getElementById('divGames');
        if (games.length>0) {
            games.forEach(game => {
                divParent.appendChild(createGameForm(JSON.parse(game)));
            });
        }
    }

    function createGameForm(game) {
        game["id"];
        var form = document.createElement('form');
        form.classList.add('form-group');
        form.classList.add('border');
        
        var crf = createCrfToken();
        var id = createField("Id:&nbsp;","gameId", game.id);
        var name = createField("Name:&nbsp;", "name", game.name);
        var state = createField("State:&nbsp;", "state", game.state);
        var round = createField("Current Round:&nbsp;", "currentRound", game.current_round);
        var question = createField("Current Question Index:&nbsp;", "currentQuestionIndex", game.current_question_index);
        var start = createField("Start Time:&nbsp;", "startTime", game.start_time);
        var cancelled = createField("Is Cancelled:&nbsp;", "isCancelled", game.is_cancelled);
        var submit = createSubmit();

        form.appendChild(crf);
        form.appendChild(id);
        form.appendChild(name);
        form.appendChild(state);
        form.appendChild(round);
        form.appendChild(question);
        form.appendChild(start);
        form.appendChild(cancelled);
        form.appendChild(submit);
        form.method = "POST";
        form.action = "/app/admin_game/";
        return form;
    }
    function createCrfToken() {
        var token = document.createElement('input');
        token.type = 'hidden';
        token.name = 'csrfmiddlewaretoken';
        token.value = '{{ csrf_token }}';
        return token;
    }
    function createField(label, valueId, value) {
        var div = document.createElement('div');
        var _label = document.createElement('label');
        var _value = document.createElement('input');

        _value.type="text";
        _value.id = valueId;
        _value.name = valueId;
        _value.value=value;
        _value.setAttribute('readonly',true);
        _label.innerHTML=label;
        _label.htmlFor=valueId
        
        div.appendChild(_label);
        div.appendChild(_value);
        return div
    }
    function createSubmit() {
        var submit = document.createElement('input');
        submit.type = 'submit';
        submit.value = "Manage"
        submit.classList.add("btn");
        submit.classList.add("btn-secondary");
        return submit;
    }

</script>

<body>
    <div id="divGames">
    </div>
    <form id="formNewGame" method="POST" action="/app/create_game/">
        {% csrf_token %}
        <input type="submit" value="New Game" />
    </form>

</body>

{% endblock %}