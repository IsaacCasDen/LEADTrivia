{% extends 'base.html'%}
{% load static %}

{% block content%}
<!-- <img src= alt="Lobby"> -->
<style>
    body{ 
    background: #fff url({% static "app/images/lobbyimage.jpg" %}) no-repeat center;
    background-color: firebrick;
    }
    #header {
        clear:both;
        position: relative;
        top: 0em;
        left:0em;
        height:auto;
        overflow: auto;
    }
    #body {
        clear:both;
        height: auto;
        overflow: auto;
        flex-wrap: wrap;
    }
    #footer {
        clear:both;
        position: relative;
        bottom: 0em;
        left:0em;
        height: auto;
        overflow: auto;
    }
    #divTeams {
        align-content:flex-start;
    }

    #userInfo {
        background-color: whitesmoke;
        margin: 1em;
    }
    .infoitem {
        display: inline;
    }

    .h1 {
        background-color: whitesmoke;
    }
    .divTeam {
        float:left;
        background-color: whitesmoke;
        padding: 1em;
        border-radius: 5%;
        border-color: black;
        border-width: 0.5;
        border-style: solid;
    }
</style>
<script>
    var data={{data|safe}};
    var username = "{{username|safe}}";
    var gameId = {{gameId|safe}};

    document.onreadystatechange=function() {
        if (document.readyState=="complete") {
            init()
        }
    }

    function init() {
        var btnNewTeam = document.getElementById("btnNewTeam");
        var formTeams = document.getElementById("formTeams");
        var divTeams = document.getElementById("divTeams");
        var divUser = document.getElementById("divUser");
        var teamIds = Object.keys(data['Teams']);

        divUser.innerText = username;

        btnNewTeam.onclick = function() {
            const hiddenField = document.createElement('input');
            hiddenField.type = 'hidden';
            hiddenField.name = 'teamId';
            hiddenField.value = null;
            formTeams.appendChild(hiddenField);
            formTeams.submit();
        }

        teamIds.forEach(element => {
            var div = createTeam(formTeams,data['Teams'][element]);
            divTeams.appendChild(div);
        });
    }
    function createTeam(parent, team) {
        var divTeam = document.createElement('div');
        divTeam.onclick = function() {
            const hiddenField = document.createElement('input');
            hiddenField.type = 'hidden';
            hiddenField.name = 'teamId';
            hiddenField.value = team['id'];
            parent.appendChild(hiddenField);
            parent.submit();
        }

        divTeam.classList.add("divTeam");

        var header = document.createElement('p');
        header.innerText=team['name'];

        var listUsers = document.createElement('ul');
        divTeam.appendChild(header);
        divTeam.appendChild(listUsers);

        team['members'].forEach(element=> {
            var user = document.createElement('li');
            user.innerText=element;
            listUsers.appendChild(user);
        })

        return divTeam;
    }

    

</script>
<body>
    <form id="formTeams" method="POST" action="/app/team/">
        {% csrf_token %}
        <div id="header">
            <p style="align-self: center;" class="h1">LEAD TRIVIA NIGHT</p>
            <div id="userInfo">
                <div class="infoitem">Welcome </div><div id="divUser" class="infoitem"></div><div class="infoitem">! Please select a team below to join, or create a new team!</div>
            </div>
        </div>
        <div id="body">
            <div id="divTeams"></div>
        </div>
        <div id="footer">
            <input id="btnNewTeam" class="btn btn-large btn-primary" type="button" value="New Team" />
        </div>
    </form>
</body>
{% endblock %}